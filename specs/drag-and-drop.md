# 기능 명세: 드래그 앤 드롭(D&D) 기능

## 질문 및 답변

### Q1: 드래그 가능한 범위

**질문**: 드래그는 월 뷰와 주 뷰 모두에서 동작하나요, 아니면 특정 뷰에서만 동작하나요? 또한 반복 일정도 드래그할 수 있나요?

**답변**: 모두 동작하며 반복 일정도 드래그 가능하지만, 드래그앤드롭 할 경우 드래그한 일정만 단일 일정으로 변환되어 새 날짜로 이동하고, 나머지 반복 일정 인스턴스들은 변경되지 않는다.

### Q2: 드롭 위치 설정

**질문**: 일정을 드롭할 때 날짜만 변경하나요, 시간도 변경하나요? 시간 변경 시 시간 단위는 어떻게 설정하나요? (예: 15분, 30분, 1시간 단위) 드롭 위치가 날짜 셀의 특정 위치(예: 시간대)에 따라 자동으로 시간이 설정되나요?

**답변**: 날짜만 변경합니다.

### Q3: 겹침 처리

**질문**: 드롭 위치에 이미 다른 일정이 있어 겹치는 경우 기존 겹침 경고 다이얼로그를 표시하나요? 자동으로 겹침을 방지하나요? (예: 다음 빈 시간대로 이동) 드롭을 취소하나요?

**답변**: 겹침 경고 다이얼로그 노출 및 드롭 취소합니다.

### Q4: 반복 일정 처리

**질문**: 반복 일정을 드래그할 때 해당 일정만 이동하나요, 전체 반복 일정이 이동하나요? 반복 일정 편집 시처럼 다이얼로그로 선택하나요?

**답변**: 드래그한 일정만 단일 일정으로 변환되어 새 날짜로 이동하고, 나머지 반복 일정 인스턴스들은 변경되지 않습니다. 다이얼로그는 없습니다.

### Q5: 시각적 피드백

**질문**: 드래그 중 드래그 중인 일정은 어떻게 표시하나요? (투명도, 그림자 등) 드롭 가능한 영역은 어떻게 표시하나요? (하이라이트, 테두리 등) 드래그 불가능한 영역(예: 일정이 있는 셀)은 어떻게 표시하나요?

**답변**: 하이라이트, 투명도, 테두리 등의 UI 변경은 없습니다.

### Q6: 드래그 시작 조건

**질문**: 드래그는 언제 시작하나요? 일정 박스를 클릭하면 바로 드래그 모드인가요? 특정 버튼/아이콘을 눌러야 드래그 모드로 전환되나요? 편집 모드 중에도 드래그가 가능한가요?

**답변**: 캘린더뷰에 특정 날짜에 이벤트가 있는데 그 날짜를 드래그 할 경우 바로 적용되며, 편집 모드에서는 기존 로직과 마찬가지로 'FR4 검증 - 편집 모드에서 날짜 클릭 시 다이얼로그 표시 및 편집 취소 선택'처럼 드래그 시 다이얼로그 표시해서 사용자가 선택할 수 있도록 규칙을 따릅니다.

### Q7: 드래그 취소

**질문**: 드래그 중 취소는 어떻게 하나요? ESC 키로 취소하나요? 드롭 불가능한 영역에 드롭하면 취소되나요? 취소 시 원래 위치로 복귀하나요?

**답변**: 드래그 취소 기능은 따로 없고, 드롭이 불가능한 영역에 드롭하면 일정이 원래 위치로 복귀한다.

### Q8: 성공 피드백

**질문**: 드래그 앤 드롭 성공 시 스낵바 메시지를 표시하나요? 시각적 애니메이션이 있나요? 별도 피드백 없이 조용히 처리하나요?

**답변**: 별도 피드백 없이 처리합니다.

## 기능 명세서

### 목적

캘린더의 일정을 마우스로 드래그하여 다른 날짜로 이동시킬 수 있는 기능입니다. 이를 통해 사용자는 일정의 날짜를 빠르고 직관적으로 변경할 수 있습니다.

### 기능 요구사항

#### FR1: 드래그 앤 드롭 기본 기능

- **설명**: 캘린더 뷰의 일정을 마우스로 드래그하여 다른 날짜 셀로 이동시킬 수 있습니다.
- **입력**: 사용자가 일정 박스를 드래그하여 다른 날짜 셀로 이동
- **출력**: 일정의 날짜가 드롭한 날짜로 변경됨
- **제약사항**:
  - 월 뷰와 주 뷰 모두에서 동작
  - 날짜만 변경되며 시간은 유지됨
  - `@dnd-kit/core` 라이브러리 사용

#### FR2: 반복 일정 드래그 처리

- **설명**: 반복 일정을 드래그하여 이동할 경우, 드래그한 일정만 단일 일정으로 변환되어 새로운 날짜로 이동됩니다. 나머지 반복 일정 인스턴스들은 변경되지 않고 그대로 유지됩니다.
- **입력**: 반복 일정(일/주/월/년 반복) 중 하나를 드래그하여 다른 날짜로 이동
- **출력**: 드래그한 일정만 단일 일정으로 변환되어 새로운 날짜로 이동되고, 나머지 반복 일정 인스턴스는 변경 없음
- **변환 규칙**:
  - 드래그한 일정의 `repeat.type`을 `'none'`으로 변경
  - 드래그한 일정의 `repeat.interval`을 `0`으로 변경
  - 드래그한 일정의 `repeat.endDate`를 `undefined`로 설정
  - 드래그한 일정의 날짜를 새로운 날짜로 변경
  - 나머지 일정 정보(제목, 시간, 설명 등)는 유지
  - 나머지 반복 일정 인스턴스들은 변경하지 않음

#### FR3: 겹침 검사 및 다이얼로그

- **설명**: 드롭 위치에 이미 다른 일정이 있어 시간이 겹치는 경우, 기존 겹침 경고 다이얼로그를 표시하고 드롭을 취소합니다.
- **입력**: 드롭 위치에 겹치는 일정이 존재
- **출력**: 겹침 경고 다이얼로그 표시 및 드롭 취소
- **다이얼로그**:
  - 타입: 기존 겹침 경고 다이얼로그 재사용 (App.tsx의 `isOverlapDialogOpen`)
  - 메시지: "다음 일정과 겹칩니다: [일정 정보]"
  - 버튼: "취소" 버튼만 표시 (드롭 취소)
  - 동작: 다이얼로그에서 "취소" 클릭 시 드롭 취소, 일정은 원래 위치 유지

#### FR4: 편집 모드 중 드래그 처리

- **설명**: 현재 일정을 편집 중인 상태에서 다른 일정을 드래그하려고 하면, 편집 모드 취소 다이얼로그를 표시합니다. 사용자는 편집 모드를 취소하고 드래그를 진행할지, 아니면 편집 모드를 유지하고 드래그를 취소할지 선택할 수 있습니다.
- **입력**: 편집 중인 상태에서 다른 일정을 드래그 시작
- **출력**: 편집 모드 취소 다이얼로그 표시
- **다이얼로그**:
  - 타입: 기존 편집 모드 취소 다이얼로그 재사용 (App.tsx의 `isEditCancelDialogOpen`)
  - 메시지: "편집 중인 일정이 있습니다. 편집을 취소하고 일정을 이동하시겠습니까?"
  - 버튼:
    - "편집 취소" 버튼: 편집 모드를 취소하고 드래그 진행
      - 편집 모드 취소 (editingEvent를 null로 설정)
      - 폼 리셋 (resetForm 호출)
      - 드래그 진행 허용
    - "편집 유지" 버튼: 편집 모드를 유지하고 드래그 취소
      - 편집 모드 유지 (editingEvent 상태 유지)
      - 폼 상태 유지
      - 드래그 취소 (일정은 원래 위치 유지)

#### FR5: 월/주 뷰 모두 지원

- **설명**: 월 뷰와 주 뷰 모두에서 동일하게 드래그 앤 드롭 기능이 동작합니다.
- **입력**: 월 뷰 또는 주 뷰의 일정 드래그
- **출력**: 두 뷰 모두에서 동일한 동작 수행

#### FR6: 시각적 피드백 없음

- **설명**: 드래그 중 하이라이트, 투명도, 테두리 등의 UI 변경은 없습니다. 드래그는 조용히 진행됩니다.
- **입력**: 일정 드래그 중
- **출력**: 시각적 변화 없음

#### FR7: 드롭 성공 시 피드백

- **설명**: 드래그 앤 드롭으로 일정을 이동하면 `saveEvent` API가 호출되어 일정이 업데이트됩니다. 이때 기존 패턴대로 일정 수정 성공 스낵바가 표시됩니다. 다만 드롭 성공 그 자체에 대한 별도의 피드백(애니메이션, 추가 메시지 등)은 없습니다.
- **입력**: 드롭 성공
- **출력**:
  - `useEventOperations`의 `saveEvent` 함수 호출
  - 기존 패턴대로 일정 수정 성공 스낵바 표시 (`SUCCESS_MESSAGES.EVENT_UPDATED`)
  - 별도의 드롭 성공 피드백 없음

#### FR8: 드롭 불가능한 영역 처리

- **설명**: 드롭이 불가능한 영역(예: 날짜 셀이 아닌 영역, 캘린더 외부)에 드롭하면 일정이 원래 위치로 복귀합니다. 별도의 드래그 취소 기능(ESC 키 등)은 제공하지 않습니다.
- **입력**: 드롭 불가능한 영역에 드롭
- **출력**: 일정이 원래 위치로 복귀, 변경 없음
- **제약사항**:
  - 드롭 가능한 영역은 날짜 셀(TableCell)만 해당
  - 캘린더 외부, 일정 목록 영역, 폼 영역 등은 드롭 불가능
  - 드롭 불가능한 영역에 드롭 시 아무 변경 없이 일정 유지

### 기술적 요구사항

#### TR1: DnD 라이브러리 사용

- `@dnd-kit/core` 라이브러리를 사용하여 드래그 앤 드롭 기능 구현
- `DndContext`, `useDraggable`, `useDroppable` 훅 활용
- `@dnd-kit/core`의 기본 이벤트 핸들러 사용

#### TR2: 날짜 형식 변환

- 드롭 위치의 날짜를 `formatDate` 유틸리티 함수를 사용하여 날짜 문자열 생성
- 월 뷰: `currentDate`와 `day` (숫자)를 사용
- 주 뷰: `weekDates` 배열의 Date 객체를 사용하여 날짜 문자열 생성

#### TR3: 기존 패턴 준수

- `useEventOperations` 훅의 `saveEvent` 함수 사용하여 일정 업데이트
- `findOverlappingEvents` 유틸리티 함수를 사용하여 겹침 검사
- 기존 Dialog 컴포넌트 패턴 활용 (겹침 경고 다이얼로그, 편집 모드 취소 다이얼로그)
- `useEventForm` 훅의 `resetForm`, `setEditingEvent` 함수 활용

#### TR4: 반복 일정 변환 로직

- 드래그한 반복 일정만 단일 일정으로 변환:
  ```typescript
  {
    ...draggedEvent,
    date: newDate,
    repeat: {
      type: 'none',
      interval: 0,
      endDate: undefined,
    }
  }
  ```
- 나머지 반복 일정 인스턴스들은 변경하지 않음 (별도 업데이트 없음)

#### TR5: 이벤트 핸들링

- 일정 박스(`data-event` 속성을 가진 Box)를 드래그 가능하게 설정
- 날짜 셀(TableCell)을 드롭 가능한 영역으로 설정
- 드래그 시작 시 편집 모드 확인 및 처리
- 드롭 시 겹침 검사 및 처리
- 드롭 불가능한 영역에 드롭 시 일정을 원래 위치로 복귀시키는 로직 구현

### 사용자 시나리오

#### 시나리오 1: 정상적인 드래그 앤 드롭

1. 사용자가 월 뷰 또는 주 뷰를 확인
2. 일정 박스를 마우스로 드래그 시작
3. 다른 날짜 셀로 이동하여 드롭
4. 일정의 날짜가 드롭한 날짜로 변경됨 (시간은 유지)
5. 일정 수정 성공 스낵바가 표시됨 (기존 패턴)

#### 시나리오 2: 반복 일정 드래그 앤 드롭

1. 사용자가 반복 일정(예: 매주 월요일 회의)을 확인
2. 반복 일정 중 하나를 드래그하여 다른 날짜로 이동
3. 드래그한 일정만 단일 일정으로 변환되어 새로운 날짜로 이동됨
4. 나머지 반복 일정 인스턴스들은 변경되지 않고 그대로 유지됨
5. 일정 수정 성공 스낵바가 표시됨 (기존 패턴)

#### 시나리오 3: 겹침 발생 시

1. 사용자가 일정을 드래그하여 다른 날짜로 이동
2. 드롭 위치에 이미 다른 일정이 있어 시간이 겹침
3. 겹침 경고 다이얼로그가 표시됨
4. "취소" 버튼 클릭
5. 드롭이 취소되고 일정은 원래 위치로 유지됨

#### 시나리오 4: 편집 중 드래그 - 편집 취소 선택

1. 사용자가 기존 일정을 편집 중
2. 다른 일정을 드래그 시작
3. 편집 모드 취소 다이얼로그가 표시됨
4. "편집 취소" 버튼 클릭
5. 편집 모드가 취소되고, 드래그 진행
6. 일정이 새로운 날짜로 이동됨

#### 시나리오 5: 편집 중 드래그 - 편집 유지 선택

1. 사용자가 기존 일정을 편집 중
2. 다른 일정을 드래그 시작
3. 편집 모드 취소 다이얼로그가 표시됨
4. "편집 유지" 버튼 클릭
5. 편집 모드가 유지되고, 드래그 취소
6. 일정은 원래 위치에 유지됨

#### 시나리오 6: 드롭 불가능한 영역에 드롭

1. 사용자가 일정을 드래그 시작
2. 드롭 불가능한 영역(캘린더 외부, 일정 목록 영역 등)으로 이동
3. 드롭 불가능한 영역에 드롭
4. 일정이 원래 위치로 복귀됨
5. 아무 변경 없이 일정 유지됨

### 제외 사항

- 시간 변경 기능 (날짜만 변경)
- 드래그 중 시각적 피드백 (하이라이트, 투명도, 테두리 등)
- 드롭 성공 시 별도 피드백 (애니메이션 등) - 일정 수정 API 호출 후 기존 스낵바는 표시됨
- 드래그 취소 기능 (ESC 키 등) - 드롭 불가능한 영역에 드롭 시 자동으로 원래 위치로 복귀
- 드래그 중 일정 미리보기
- 드롭 가능한 영역 시각적 표시

### 테스트 고려사항

- 월 뷰와 주 뷰 모두에서 드래그 앤 드롭 동작 검증
- 반복 일정 드래그 시 단일 일정으로 변환되는지 검증
- 겹침 발생 시 다이얼로그 표시 및 드롭 취소 검증
- 편집 모드 중 드래그 시 다이얼로그 표시 검증
- 다이얼로그에서 "편집 취소" 선택 시 드래그 진행 검증
- 다이얼로그에서 "편집 유지" 선택 시 드래그 취소 검증
- 날짜 형식이 올바르게 변경되는지 검증
- 시간이 유지되는지 검증
- 드롭 불가능한 영역에 드롭 시 원래 위치로 복귀하는지 검증
- @dnd-kit/core 라이브러리 통합 검증
